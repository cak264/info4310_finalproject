<html>
    <header>
        <h3 id="head_h3">Cameron Kull, cak264 & Marie Williams, mcw242</h3>
        <script src="https://d3js.org/d3.v7.min.js"></script>

        <style>
            .gridlines line {
              stroke: #bbb;
            }

            .gridlines .domain {
              stroke: none;
            }

            #vis1 {
                display: flex;
            }

            #vis1 #filters {
                margin-left: 30px;
            }

            #institutionInputs, #degreeInputs {
                display: flex;
                flex-direction: column;
            }

        </style>
    </header>
    <body>

        <div id="vis1">
            <svg width="900" height="600" id="line-chart"></svg>
            <g id="filters"></g>
        </div>

        <script>
            let lineChart = d3.select("#line-chart");
            const lc_width = lineChart.attr("width");
            const lc_height= lineChart.attr("height");
            const lc_margins={top: 10, right: 10, bottom: 50, left: 60};
            const lchartWidth = lc_width - lc_margins.left - lc_margins.right;
            const lchartHeight = lc_height - lc_margins.top - lc_margins.bottom;
            const lineChartArea = lineChart.append("g")
                                           .attr("transform", `translate(${lc_margins.left}, ${lc_margins.top})`);


            let requestData = async function(){
                let meanIncomes = await d3.csv("mean_income.csv", d3.autoType);
                console.log(meanIncomes);

                let tuition = await d3.csv("tuition.csv", d3.autoType);
                console.log(tuition);

                let parentBins = await d3.csv("parent_incomes.csv", d3.autoType);
                console.log(parentBins);

                let attendStats = await d3.csv("top139_attend.csv", d3.autoType);
                console.log(attendStats);

                // income and year extents and scales
                let yearExtent = d3.extent(meanIncomes, m=>m.Year);

                let yearScale = d3.scaleLinear().domain(yearExtent).range([0, lchartWidth]);
                let lowIncomeExtent = d3.extent(meanIncomes, m=>m.current_firstQuintile);
                console.log(lowIncomeExtent);
                let highIncomeExtent = d3.extent(meanIncomes, m=>m.current_fifthQuintile);
                console.log(highIncomeExtent);
                let middleIncomeExtent = d3.extent(meanIncomes, m=>m.current_thirdQuintile);
                // let dollarScale = d3.scaleLinear().domain([lowIncomeExtent[0], highIncomeExtent[1]]).range([lchartHeight, 0]);
                let dollarScale = d3.scaleLinear().domain([lowIncomeExtent[0], middleIncomeExtent[1]+5000]).range([lchartHeight, 0]);

                // axes
                let lineLeftAxis = d3.axisLeft(dollarScale);
                lineChart.append("g")
                             .attr("transform", `translate(${lc_margins.left-10}, ${lc_margins.top})`)
                             .call(lineLeftAxis);
                let lineLeftAxisGridlines = d3.axisLeft(dollarScale)
                                              .tickSize(-lchartWidth-10)
                                              .tickFormat('');
                lineChart.append("g")
                             .attr("transform", `translate(${lc_margins.left-10}, ${lc_margins.top})`)
                             .attr("class", "gridlines")
                             .call(lineLeftAxisGridlines);

                let lineBottomAxis = d3.axisBottom(yearScale)
                                       .tickFormat(d3.format(".0f"));
                lineChart.append("g")
                             .attr("transform", `translate(${lc_margins.left}, ${lc_margins.top+lchartHeight+10})`)
                             .call(lineBottomAxis);

                lineChartArea.raise();

                // create bars
                lineChartArea.selectAll("rect").data(meanIncomes)
                             .join("rect")
                             .attr("x", m=> yearScale(m.Year)-4)
                             .attr("y", m=> dollarScale(m.current_thirdQuintile))
                             .attr("width", 10)
                             .attr("height", m=> lchartHeight-dollarScale(m.current_thirdQuintile))
                             .attr("fill", "steelblue");

                // creating tuition line
                function createLine(inst_type, dol_type, degree_length) {
                    let filteredTuition = tuition.filter(t=> t.institution_type == inst_type & t.dollar_type == dol_type);

                    let line = d3.line()
                            .x(d => yearScale(d.year))
                            .y(d => dollarScale(d[degree_length]));

                    lineChartArea.append("path").datum(filteredTuition)
                                .join("path")
                                .attr("class", inst_type+"_"+dol_type)
                                .attr("fill", "none")
                                .attr("stroke", "black")
                                .attr("stroke-width", 3)
                                .attr("d", line);

                    lineChartArea.selectAll("circle").data(filteredTuition)
                                .join("circle")
                                .attr("cx", d=> yearScale(d.year))
                                .attr("cy", d=> dollarScale(d[degree_length]))
                                .attr("r", 3)
                                .attr("fill", "black");
                }

                createLine("all", "current", "four_and_two_year");

                // adding inputs to filter panel
                let filterPanel = d3.select("#filters");
                filterPanel.append("h2").text("University Details");

                filterPanel.append("h3").text("Dollar Value");
                filterPanel.append("button").text("Current Dollars");
                filterPanel.append("button").text("2021 Adjusted Dollars");

                filterPanel.append("h3").text("Institution Type");
                let institutionInputs = filterPanel.append("div").attr("id", "institutionInputs");
                let inst_types = ["All", "Public", "Private", "Nonprofit", "For-Profit"];
                inst_types.forEach(type => {
                    let block = institutionInputs.append("g");
                    block.append("input").attr("type", "checkbox").attr("id", "check1"+type);
                    block.append("label").attr("for", "check1"+type).text(type);
                })


                filterPanel.append("h3").text("Degree Length");
                let degreeInputs = filterPanel.append("div").attr("id", "degreeInputs");
                let degree_types = ["All", "Four Year", "Two Year"];
                degree_types.forEach(type => {
                    let block = degreeInputs.append("g");
                    block.append("input").attr("type", "checkbox").attr("id", "check2"+type);
                    block.append("label").attr("for", "check2"+type).text(type);
                })



            }

            requestData();
        </script>
    </body>
</html>
